<!DOCTYPE html>
<html>
    <head>
        <title>Karopapier 2.1</title>
        <script type="text/javascript" src="/js/libs/jquery-1.11.3.min.js"></script>
        <script type="text/javascript" src="/js/libs/jquery-ui-1.11.4.custom.min.js"></script>
        <script type="text/javascript" src="/js/libs/underscore-min.js"></script>
        <script type="text/javascript" src="/js/libs/backbone-min.js"></script>
        <script type="text/javascript" src="/js/libs/backbone.marionette.min.js"></script>
        <script type="text/javascript" src="/js/libs/backbone-model-factory.js"></script>
        <script type="text/javascript" src="/js/libs/hammer.min.js"></script>
        <!--<script type="text/javascript" src="js/libs/Sideslide.js"></script> -->
        <!--<script type="text/javascript" src="js/libs/touch-emulator.js"></script>
        <script> TouchEmulator(); </script> -->

        <script type="text/javascript" src="/js/libs/TURTED.js"></script>
        <script type="text/javascript" src="/js/libs/sockjs-0.3.min.js"></script>

        <script type="text/javascript" src="/js/templates/JST.js"></script>
        <script type="text/javascript" src="/js/KaroBackbone.min.js"></script>

        <script type="text/javascript">
            var Karopapier = new KaropapierApp();
        </script>

        <link id="favicon" rel="shortcut icon" href="favicon.ico" />

        <link rel="stylesheet" href="css/main.css" />
        <link rel="stylesheet" href="css/global.css?v=3" />
        <link rel="stylesheet" href="css/chat.css" />
        <link rel="stylesheet" href="css/notifier.css" />
        <link rel="stylesheet" href="http://www.karopapier.de/css/quicktip/quicktip.css?v=6" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
        <meta charset="utf-8" />
    </head>
    <body>
        <header id="header"></header>
        <div id="content">Content</div>
        <footer id="footer">
            <a href="http://www.karopapier.de">Karopapier.de</a> is brought to you by
            <script type="text/javascript">document.write(String.fromCharCode(0x44, 0x69, 0x64, 0x69).link(String.fromCharCode(0x6d, 0x61, 0x69, 0x6c, 0x74, 0x6f, 0x3a, 0x64, 0x69, 0x64, 0x69, 0x40, 0x6b, 0x61, 0x72, 0x6f, 0x70, 0x61, 0x70, 0x69, 0x65, 0x72, 0x2e, 0x64, 0x65)));</script>
        </footer>

        <script type="text/javascript">

            Karopapier.vent.on("logout", function() {
                console.log("Logging out");
                Karopapier.User.set("id", 0);
                console.log(Karopapier.User);
            })

            Karopapier.vent.on("login", function() {
                console.log("Logging in");
                $.post("http://www.karopapier.de/api/user/login.json",{"login":login, "password":pass},function(data) {
                    console.log(data);
                    Karopapier.User.set(data);
                })
            })

            Karopapier.vent.on('GAME:MOVE', function (data) {
                //skip unrelated
                if (!data.related) {
                    console.log(data.movedLogin, "zog bei",data.gid, data.name);
                    //return false;
                }

                if (Karopapier.User.get("id") == data.nextId) {
                    Karopapier.notifier.addUserDranNotification(data);
                } else {
                    Karopapier.notifier.addGameMoveNotification(data);
                }
            });

            Karopapier.vent.on('GAME:MOVE', function (data) {
                var movedUser = new User({id: data.movedId, login: data.movedLogin})
                movedUser.decreaseDran();
                var nextUser = new User({id: data.nextId, login: data.nextLogin});
                nextUser.increaseDran();
            });

            $(document).ready(function () {
                console.log("Doc ready, start app");
                Karopapier.start({
                    baseApiUrl: "http://www.karopapier.de/api/"
                });

                console.log("App started");
                Karopapier.addRegions({
                    header: '#header',
                    content: '#content',
                    footer: '#footer'
                })

                Karopapier.chatApp = new ChatApp();
                Karopapier.content.show(Karopapier.chatApp);

                Karopapier.favi = new FaviconView({
                    model: Karopapier.User,
                    el: '#favicon'
                })

                Karopapier.infoBar = new UserInfoBar({
                    model: Karopapier.User
                });
                Karopapier.header.show(Karopapier.infoBar);


				//var rightSlide = new Sideslide(document.getElementById('chatInfo'));
            })

        </script>


        <script type="text/javascript">
            if ( !/karopapier/.test(window.location.hostname) ) {
                document.write('<scr' + 'ipt src="http://localhost:35729/livereload.js"></scr' + 'ipt>');
            }
        </script>
    </body>
</html>

