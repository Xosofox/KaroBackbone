<!DOCTYPE html>
<html>
    <head>
        <title>Karopapier 2.1</title>
        <script type="text/javascript" src="js/libs/jquery-1.11.0.min.js"></script>
        <script type="text/javascript" src="js/libs/jquery-ui-1.10.4.custom.min.js"></script>
        <script type="text/javascript" src="js/libs/underscore-min.js"></script>
        <script type="text/javascript" src="js/libs/backbone-min.js"></script>
        <script type="text/javascript" src="js/libs/backbone.marionette.min.js"></script>
        <script type="text/javascript" src="js/libs/backbone-model-factory-min.js"></script>
        <script type="text/javascript" src="js/libs/TURTED.js"></script>
        <script type="text/javascript" src="js/libs/sockjs-0.3.min.js"></script>

        <script type="text/javascript">
            var Karopapier = new Marionette.Application(); // currently only for Util.js to not throw an error
        </script>

        <script type="text/javascript" src="js/templates/JST.js"></script>
        <script type="text/javascript" src="js/KaroBackbone.min.js"></script>

        <link id="favicon" rel="shortcut icon" href="favicon.ico" />

        <link rel="stylesheet" href="css/main.css" />
        <link rel="stylesheet" href="css/global.css" />
        <link rel="stylesheet" href="css/chat.css" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    </head>
    <body>
        <header id="header"><h1>Karopapier</h1></header>
        <div id="content">Content</div>
        <footer id="footer">
            Todo
            <ul>
                <li>UserInfo top right</li>
                <li>Routing</li>
                <li>Editor</li>
                <li>Game</li>
                <li>Karotris</li>
            </ul>
        </footer>

        <script type="text/javascript">

            var DumbView = Backbone.View.extend({
                template: window["JST"]["dumbview"],
                initialize: function () {
                    _.bindAll(this, "render");
                    return this;
                },
                render: function () {
                    console.log("Rendering dumb view");
                    this.$el.html(this.template({adjective: "nice"}));
                    return this;
                }
            })

            var dumbView = new DumbView();


            Karopapier.addInitializer(function (options) {
                // do useful stuff here
                console.log("Initializer der App");
                Karopapier.User = new User({});
                //make this user refer to "check" for loging in
                Karopapier.User.url = function () {
                    return "http://reloaded.karopapier.de/api/user/check.json?callback=?"
                }
                Karopapier.User.fetch();
            });

            $(document).ready(function () {

                console.log("Doc ready, start app");
                Karopapier.start({
                    baseApiUrl: "http://reloaded.karopapier.de/api/"
                });

                console.log("App started");
                Karopapier.addRegions({
                    header: '#header',
                    content: '#content',
                    footer: '#footer'
                })

                Karopapier.chatApp = new ChatApp()
                Karopapier.content.show(Karopapier.chatApp);

                var favi = new FaviconView({
                    model: Karopapier.User,
                    el: '#favicon'
                })

                var turted = new TURTED("http://ape.reloaded.karopapier.de/turted");
                turted.ident(1, 'Didi', "asdf");
                turted.join("karochat");
                turted.join("livelog");
                turted.on('anyOtherMoved', function (data) {
                    console.log("anyOtherMoved", data);
                    var movedUser = new User({id: data.movedId, login: data.movedLogin})
                    movedUser.decreaseDran();
                    var nextUser = new User({id: data.nextId, login: data.nextLogin});
                    nextUser.increaseDran();
                });
                turted.on('newChatMessage', function (data) {
                    Karopapier.chatApp.chatMessageCollection.fetch();
                });
            })

        </script>
    </body>
</html>
