<!doctype html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>Backbone Routing</title>
        <style type="text/css">
            header,footer,nav,section { display: block; }
        </style>
    </head>

    <body>
        <div id="container">
            <div id="sidebar">
                <ul id="navi">
                    <li><a href="#game/70321">Spiel</a></li>
                    <li><a href="#game/70178">Nacht</a></li>
                    <li><a href="#game/70179">Nacht2</a></li>
                    <li><a href="#editor">Editor home</a></li>
                    <li><a href="#editor/1">Map 1</a></li>
                    <li><a href="#editor/5">Map 5</a></li>
                </ul>
            </div>
            <div id="content">
            </div>

            <script type="text/javascript" src="../js/libs/underscore-min.js"></script>
            <script type="text/javascript" src="../js/libs/jquery-1.7.2.min.js"></script>
            <script type="text/javascript" src="../js/libs/backbone-min.js"></script>
            <script type="text/javascript" src="../js/libs/backbone.marionette.min.js"></script>

            <script type="text/javascript">

                var Karopapier; //global for easier console debug access;

                $(document).ready(function () {
                    //var Karopapier = new Backbone.Marionette.Application(); //the main app
                    Karopapier = new Backbone.Marionette.Application(); //the main app

                    Karopapier.addRegions({
                        content: "#content"
                    })

                    Karopapier.module("StaticApp", function (StaticApp, Karopapier, Backbone, Marionette, $, _) {

                        var StaticView = Backbone.Marionette.ItemView.extend({
                            tagName: "div",
                            id: "staticContent",
                            content: "static-welcome",
                            template: '#static-welcome-template',
                            render: function() {
                                this.$el.html(Backbone.Marionette.TemplateCache.get('#'+this.content+'-template'));
                            }
                        });

                        StaticApp.show=function(id) {
                            this.StaticView.content=id;
                            this.StaticView.render();
                        }

                        Karopapier.addInitializer(function() {
                            console.log("Show static");
                            Karopapier.StaticApp.StaticView= new StaticView();
                            Karopapier.StaticApp.show('static-introduction');
                            Karopapier.content.show(Karopapier.StaticApp.StaticView);
                        });
                    });

                    Karopapier.module("GameApp", function (GameApp, Karopapier, Backbone, Marionette, $, _) {
                        ga= Backbone.Marionette.Application.extend({
                        });

                        GameApp.showGame = function(id) {
                            console.info("Zeige SPiel " + id);
                            setTimeout(function(){Karopapier.content.show(Karopapier.GameApp.layout)},600);
                        };
                        GameApp.Router= Backbone.Marionette.AppRouter.extend({
                            appRoutes: {
                                "game/:id": "showGame"
                            },
                            controller: GameApp
                        });
                        GameApp.router=new GameApp.Router();
                        Karopapier.addInitializer(function() {
                            Backbone.history.start();
                        });
                    });

                    Karopapier.module("EditorApp", function (EditorApp, Karopapier, Backbone, Marionette, $, _) {
                    });

                    Karopapier.module("GameLayout", function (GameLayout, Karopapier, Backbone, Marionette, $, _) {

                        var GameLayout = Backbone.Marionette.Layout.extend({
                            id: "gameLayout",
                            template:"#game-layout-template",

                            regions:{
                                gameMapView:"#gameMap",
                                gameInfoView:"#gameInfo",
                                gameNavi: "#gameNavi"
                            }
                        });

                        Karopapier.addInitializer(function() {
                            console.debug("Init lay");
                            Karopapier.GameApp.layout=new GameLayout();
                        });
                    });
                    Karopapier.start();
                });

            </script>
            <script id="game-layout-template" type="text/template">
                <div id="gameMap"></div>
                <div id="gameInfo"></div>
                <div id="gameNavi"></div>
            </script>
            <script id="static-welcome-template" type="text/template">
                <h1>Welcome</h1>
            </script>
            <script id="static-introduction-template" type="text/template">
                <h1>Introduction</h1>
            </script>
    </body>
</html>
